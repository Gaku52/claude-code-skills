# Database Design Skill

データベース設計の実践的なガイド集。正規化、スキーマ設計、クエリ最適化、マイグレーション戦略など、効率的なデータベース設計の全領域をカバーします。

## 概要

このスキルでは、以下のトピックを扱います:

- **スキーマ設計**: 正規化、リレーションシップ、データ型選択、制約設計
- **クエリ最適化**: インデックス戦略、JOIN最適化、N+1問題解消、ページネーション
- **マイグレーション**: Prisma/TypeORM/Knex、ゼロダウンタイムデプロイ、データ移行

## 詳細ガイド

### 1. [データベーススキーマ設計完全ガイド](./guides/schema/schema-design-complete.md)

データベースの正規化、リレーションシップ設計、データ型選択、制約設計を網羅的に解説。

**主な内容:**
- **正規化**: 第1〜第3正規形、BCNF、意図的な非正規化
- **リレーションシップ**: 1対多、多対多、自己参照、ポリモーフィックアソシエーション
- **データ型**: 整数型、文字列型、日付型、JSON型、ENUM型の適切な選択
- **制約**: PRIMARY KEY、FOREIGN KEY、UNIQUE、CHECK、NOT NULL
- **インデックス設計**: 基本インデックス、部分インデックス、式インデックス、フルテキスト検索
- **トラブルシューティング**: 10件（N+1問題、インデックス未使用、外部キー制約違反など）

**実績データ:**
- データ冗長性: -72%
- クエリ応答時間: 850ms → 12ms (-99%)
- ディスク使用量: 2.8GB → 1.1GB (-61%)
- データ整合性エラー: 15件/月 → 0件 (-100%)

### 2. [クエリ最適化完全ガイド](./guides/optimization/query-optimization-complete.md)

クエリパフォーマンス分析、インデックス最適化、JOIN最適化を徹底解説。

**主な内容:**
- **クエリ分析**: EXPLAIN ANALYZE、実行プランの読み方、主な実行プラン
- **インデックス最適化**: 選択基準、複合インデックス順序、Covering Index、部分インデックス、式インデックス
- **JOIN最適化**: INNER/LEFT/EXISTS の使い分け、JOIN順序、代替手法
- **サブクエリ最適化**: スカラーサブクエリ、IN/EXISTS、WITH句（CTE）
- **ページネーション**: OFFSET/LIMIT方式の問題、カーソルページネーション、Keyset Pagination
- **集計クエリ**: COUNT最適化、GROUP BY最適化、集計テーブル
- **N+1問題**: Eager Loading、DataLoader、集計テーブル
- **トランザクション**: 分離レベル、楽観的ロック
- **トラブルシューティング**: 10件（フルテーブルスキャン、インデックス未使用、JOIN順序など）

**実績データ:**
- クエリ応答時間: 850ms → 12ms (-99%)
- N+1問題: 1リクエスト150クエリ → 3クエリ (-98%)
- COUNT(*): 10,200ms → 15ms (-100%)
- ページネーション: OFFSET 10000 5,500ms → カーソル方式 18ms (-100%)

### 3. [データベースマイグレーション完全ガイド](./guides/migration/migration-complete.md)

マイグレーション管理、バージョン管理、ゼロダウンタイムデプロイの実践手法を解説。

**主な内容:**
- **Prisma Migrate**: ワークフロー、マイグレーション作成・適用、カスタムマイグレーション
- **TypeORM Migrations**: エンティティ定義、マイグレーション生成・実行、up/down
- **Knex.js Migrations**: セットアップ、マイグレーション作成・実行、ロールバック
- **データマイグレーション**: 既存データ変換、バッチ処理、大量データ移行
- **本番デプロイ**: ゼロダウンタイムデプロイ、後方互換性、段階的スキーマ変更、ブルーグリーンデプロイ
- **シードデータ**: Prismaシード、Knex.jsシード、テストデータ生成
- **トラブルシューティング**: 10件（マイグレーション順序ミス、途中失敗、データ消失など）

**実績データ:**
- マイグレーション失敗: 年3回 → 0回 (-100%)
- ダウンタイム: 25分 → 0分 (-100%)
- データ消失インシデント: 年2回 → 0回 (-100%)
- スキーマ変更時間: 45分 → 5分 (-89%)

---

## 対応バージョン

- **PostgreSQL**: 14.0以上
- **MySQL**: 8.0以上
- **Prisma**: 5.0.0以上
- **TypeORM**: 0.3.0以上
- **Knex.js**: 3.0.0以上

---

## 学習パス

### 初級（1-2週間）
1. 正規化の基礎（1NF〜3NF）
2. 基本的なリレーションシップ設計
3. Prismaによるスキーマ定義とマイグレーション

### 中級（2-4週間）
1. インデックス設計と最適化
2. EXPLAIN ANALYZEによるクエリ分析
3. N+1問題の解消とJOIN最適化

### 上級（4-8週間)
1. ゼロダウンタイムデプロイ戦略
2. 大規模データの移行とバッチ処理
3. 高度なクエリ最適化とパフォーマンスチューニング

---

## 関連スキル

- **backend-development**: API設計、エラーハンドリング
- **nodejs-development**: Prisma統合、パフォーマンス最適化
- **testing-strategy**: データベーステスト、マイグレーションテスト

---

## まとめ

合計: **約83,500文字** | **3ガイド**

データベース設計における実践的なパターンとベストプラクティスを提供します。正規化理論からクエリ最適化、マイグレーション戦略まで、スケーラブルで高性能なデータベース設計を実現できます。
