# 暗号の基礎

> 現代の暗号はCSの計算複雑性理論に基づいており、「解くのが困難な問題」の存在が安全性を保証する。

## この章で学ぶこと

- [ ] 共通鍵暗号と公開鍵暗号の違いを説明できる
- [ ] ハッシュ関数の性質と用途を理解する
- [ ] TLS/HTTPSの仕組みを概要レベルで説明できる

---

## 1. 暗号の基本

### 1.1 共通鍵暗号

```
共通鍵暗号: 暗号化と復号に同じ鍵を使用

  平文 →[暗号化(鍵K)]→ 暗号文 →[復号(鍵K)]→ 平文

  代表的アルゴリズム:
  - AES-256: 現代の標準。128ビットブロック、256ビット鍵
  - ChaCha20: モバイル向け高速暗号（TLS 1.3で採用）

  利点: 高速（AES-NI命令で数GB/秒）
  課題: 鍵の共有問題（どうやって安全に鍵を渡す？）
```

### 1.2 公開鍵暗号

```
公開鍵暗号: 暗号化と復号に異なる鍵を使用

  送信者: 受信者の公開鍵で暗号化
  受信者: 自分の秘密鍵で復号

  平文 →[暗号化(公開鍵)]→ 暗号文 →[復号(秘密鍵)]→ 平文

  代表的アルゴリズム:
  - RSA: 素因数分解の困難性に基づく（1977年）
  - ECDH/ECDSA: 楕円曲線暗号（鍵サイズが小さい）
  - Ed25519: 署名用（SSH, TLS）

  利点: 鍵の共有問題を解決
  課題: 低速（共通鍵の100-1000倍遅い）
  → 実務: 公開鍵暗号で共通鍵を交換し、共通鍵暗号でデータを暗号化
```

### 1.3 ハッシュ関数

```
暗号学的ハッシュ関数:

  任意長データ → 固定長ハッシュ値

  要件:
  1. 一方向性: ハッシュから元データを復元できない
  2. 衝突耐性: 同じハッシュになる異なるデータを見つけられない
  3. 雪崩効果: 1ビットの変更で出力が大きく変化

  代表的アルゴリズム:
  - SHA-256: 256ビット出力。Bitcoin、TLS
  - SHA-3 (Keccak): SHA-2とは異なる構造
  - BLAKE3: 高速ハッシュ（SHA-256の15倍速）

  用途:
  - パスワード保存（bcrypt, Argon2 + ソルト）
  - データ整合性検証（ファイルのチェックサム）
  - デジタル署名
  - ブロックチェーン（マイニング）
  - Git（コミットハッシュ = SHA-1）
```

---

## 2. TLS/HTTPSの仕組み

```
TLS 1.3 ハンドシェイク（簡略化）:

  クライアント                    サーバー
  │                              │
  │── ClientHello ──────────────→│  支援する暗号スイートを通知
  │   (対応暗号一覧, ECDH公開鍵) │
  │                              │
  │←── ServerHello ──────────────│  暗号スイート決定
  │    (証明書, ECDH公開鍵)      │
  │                              │
  │ [共通秘密鍵を導出]           │  [共通秘密鍵を導出]
  │ (ECDH鍵交換)                 │
  │                              │
  │←→ 暗号化通信（AES-256-GCM）→│  以降全て暗号化
  │                              │

  TLS 1.3 の改善点:
  - 1-RTT ハンドシェイク（TLS 1.2 は 2-RTT）
  - 0-RTT 再接続（以前の接続情報を再利用）
  - 安全でないアルゴリズムを排除（RC4, DES, MD5等）
```

---

## 3. ポスト量子暗号

```
量子コンピュータの脅威:

  Shor のアルゴリズム:
  - RSA, ECDSA, ECDH を多項式時間で破る
  - 十分な量子ビット数（数千〜数万論理qubit）が必要
  - 現在は数百物理qubit → まだ数十年先？

  ポスト量子暗号（NIST標準化、2024年）:
  - ML-KEM (CRYSTALS-Kyber): 鍵カプセル化（格子暗号）
  - ML-DSA (CRYSTALS-Dilithium): デジタル署名（格子暗号）
  - SLH-DSA (SPHINCS+): ハッシュベース署名

  対策:
  - 「Harvest Now, Decrypt Later」攻撃に注意
  - 長期保存が必要なデータは今から対策を検討
```

---

## 4. 実践演習

### 演習1: ハッシュ体験（基礎）
SHA-256で文字列をハッシュし、1文字変えた時の出力変化を確認せよ。

### 演習2: 鍵交換（応用）
Diffie-Hellman鍵交換を小さな素数で手計算せよ。

---

## まとめ

| 概念 | ポイント |
|------|---------|
| 共通鍵暗号 | 高速。AES-256。鍵共有が課題 |
| 公開鍵暗号 | 鍵共有を解決。RSA, ECDH。低速 |
| ハッシュ | 一方向。SHA-256。パスワード、整合性検証 |
| TLS | 公開鍵で鍵交換→共通鍵で暗号化 |
| ポスト量子 | 格子暗号が新標準。移行が始まっている |

---

## 次に読むべきガイド
→ [[05-lambda-calculus.md]] — ラムダ計算

---

## 参考文献
1. Ferguson, N. & Schneier, B. "Cryptography Engineering." Wiley, 2010.
2. Katz, J. & Lindell, Y. "Introduction to Modern Cryptography." CRC Press, 2020.
3. NIST. "Post-Quantum Cryptography Standardization." 2024.
