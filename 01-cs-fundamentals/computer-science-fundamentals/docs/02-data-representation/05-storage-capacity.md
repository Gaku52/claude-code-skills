# データ量の感覚

> 「ギガバイト」「テラバイト」と聞いて具体的なイメージが浮かぶようになれば、システム設計の見積もりは格段に正確になる。

## この章で学ぶこと

- [ ] 各種データの典型的なサイズを知る
- [ ] ストレージ/帯域幅の見積もりができる
- [ ] システム設計における容量計算ができる

## 前提知識

- データサイズの単位 → 参照: [[00-binary-and-number-systems.md]]
- 圧縮の基礎 → 参照: [[04-compression-algorithms.md]]

---

## 1. データサイズの直感

### 1.1 テキストデータ

```
テキストの容量:

  1文字 (ASCII):          1バイト
  1文字 (日本語UTF-8):     3バイト
  1ツイート (280文字):     約560バイト〜840バイト
  1ページの文章:           約2KB (英語) / 約4KB (日本語)
  小説1冊 (10万字):       約300KB (UTF-8日本語)
  Wikipedia英語版全文:     約22GB (非圧縮)
  青空文庫全作品:          約2GB

  実務での目安:
  JSON APIレスポンス:       1KB - 100KB
  ログ1行:                 100B - 1KB
  1日のアプリログ:          100MB - 10GB
  RDBの1レコード:           100B - 10KB
```

### 1.2 画像データ

```
画像の容量:

  アイコン (32×32, PNG):          約2KB
  サムネイル (200×200, JPEG):     約10KB
  Web画像 (800×600, JPEG75):      約80KB
  フルHD写真 (1920×1080):
    非圧縮 BMP:                    約6MB
    JPEG (品質85):                 約500KB
    WebP:                          約300KB
  4K写真 (3840×2160, JPEG):       約3MB
  RAW写真 (6000×4000):            約25-50MB

  スマホ1枚の写真:                約3-5MB (HEIF/JPEG)
  1000枚の写真:                   約3-5GB

  実務での目安:
  ユーザーアバター:         50KB - 200KB
  ECサイト商品画像:         100KB - 500KB
  LP/バナー画像:            200KB - 2MB
  Webページ画像合計:        500KB - 5MB (目標: 1MB以下)
```

### 1.3 音声データ

```
音声の容量:

  電話品質 (8kHz, 8bit, mono):      8 KB/秒
  CD品質 (44.1kHz, 16bit, stereo):  176 KB/秒 = 10.6 MB/分

  MP3 (128kbps):     約1MB/分 → 1曲(4分) ≈ 4MB
  MP3 (320kbps):     約2.4MB/分
  AAC (256kbps):     約2MB/分
  FLAC (可逆):       約5MB/分 → 1曲 ≈ 20MB
  WAV (非圧縮):      約10MB/分

  Podcast 1時間 (MP3 128kbps):      約60MB
  音楽ライブラリ 1000曲:            約4GB (MP3) / 20GB (FLAC)
  Apple Music / Spotify の1曲:      約10MB (AAC 256kbps)
```

### 1.4 動画データ

```
動画の容量:

  非圧縮 1080p 30fps:           約186 MB/秒

  YouTube品質別 (1分あたり):
    360p:     約5MB
    720p:     約15MB
    1080p:    約35MB
    4K:       約100MB

  Netflix (1時間):
    SD:      約0.7GB
    HD:      約3GB
    4K HDR:  約7GB

  Zoom通話 (1時間):
    音声のみ:  約40MB
    ビデオ720p: 約800MB

  実務での目安:
  30秒のプロモ動画:       5-20MB (Web用)
  YouTube 10分動画:       100-500MB (元ファイル)
  映画1本 (4K):           20-50GB (Blu-ray)
```

---

## 2. システム設計の容量見積もり

### 2.1 Twitterの容量計算例

```
Twitter風サービスの容量見積もり:

  前提:
  - DAU: 300M (3億)
  - 1人あたり平均2ツイート/日
  - テキスト平均200文字 (UTF-8: 400バイト)
  - 20%のツイートに画像添付 (平均200KB)
  - メタデータ: 200バイト/ツイート

  1日のデータ量:
  ──────────────────
  ツイート数:   300M × 2 = 600M ツイート/日
  テキスト:     600M × 600B = 360GB/日
  画像:         600M × 0.2 × 200KB = 24TB/日
  合計:         約24TB/日

  年間:         24TB × 365 = 約8.8PB/年

  ストレージ要件:
  - レプリカ3倍: 8.8PB × 3 = 26.4PB/年
  - 5年保持: 26.4 × 5 = 132PB
  - 圧縮50%: 66PB

  帯域幅:
  - 読み取り比 100:1 (読む方が圧倒的に多い)
  - ピーク時QPS: 600M/86400 × 3 (ピーク係数) = 約20,800 QPS (書込)
  - 読み取りQPS: 20,800 × 100 = 約2,080,000 QPS
```

### 2.2 よくあるシステムの容量

```
サービス規模別の目安:

  ┌─────────────────┬──────────┬──────────┬───────────┐
  │ 規模            │ DB       │ ストレージ │ 帯域幅    │
  ├─────────────────┼──────────┼──────────┼───────────┤
  │ 個人ブログ      │ 100MB    │ 10GB     │ 10Mbps   │
  │ スタートアップ   │ 10GB     │ 1TB      │ 100Mbps  │
  │ 中規模サービス   │ 1TB      │ 100TB    │ 10Gbps   │
  │ 大規模サービス   │ 100TB    │ 10PB     │ 1Tbps    │
  │ FAANG          │ 10PB+    │ 1EB+     │ 100Tbps+ │
  └─────────────────┴──────────┴──────────┴───────────┘
```

### 2.3 レイテンシの数字（Jeff Dean's Numbers 2024版）

```
プログラマが知るべきレイテンシ:

  操作                          時間          比喩
  ──────────────────────────────────────────────────
  L1キャッシュ参照               1 ns         瞬き
  分岐予測ミス                   3 ns
  L2キャッシュ参照               4 ns
  ミューテックスのロック/アンロック 17 ns
  L3キャッシュ参照               20 ns
  メインメモリ参照               100 ns        まばたき
  1KB zippy圧縮                 2,000 ns
  SSD ランダム読み取り           16,000 ns     くしゃみ
  1MB メモリから連続読み取り      3,000 ns
  1MB SSD から連続読み取り       49,000 ns
  1MB HDD から連続読み取り       825,000 ns
  同一DC内ラウンドトリップ        500,000 ns    深呼吸
  HDD シーク                    2,000,000 ns
  パケット: CA→NL→CA            150,000,000 ns 昼寝

  覚えるべき比率:
  - メモリ vs SSD:    100倍
  - SSD vs HDD:      50-100倍
  - DC内 vs 大陸間:   300倍
  - メモリ vs ネット:  5,000倍
```

---

## 3. 帯域幅の計算

### 3.1 ネットワーク帯域幅

```
帯域幅の実務計算:

  注意: ネットワーク速度は bit/s、ファイルサイズは byte
  → 1 Gbps = 125 MB/s（8で割る）

  実効帯域幅（オーバーヘッド考慮）:
  1 Gbps → 実効 約100-110 MB/s
  10 Gbps → 実効 約1.1 GB/s

  ダウンロード時間の目安:
  ┌──────────────┬─────────┬──────────┬──────────┐
  │ ファイル      │ 10Mbps  │ 100Mbps  │ 1Gbps   │
  ├──────────────┼─────────┼──────────┼──────────┤
  │ Webページ(2MB)│ 1.6秒   │ 0.16秒   │ 0.016秒 │
  │ 曲1曲(4MB)   │ 3.2秒   │ 0.32秒   │ 0.032秒 │
  │ 映画(5GB)    │ 67分    │ 6.7分    │ 40秒    │
  │ ゲーム(50GB) │ 11時間  │ 67分     │ 6.7分   │
  │ バックアップ1TB│ 9.3日  │ 22時間   │ 2.2時間 │
  └──────────────┴─────────┴──────────┴──────────┘

  Sneakernet（物理メディア輸送）:
  「トラック一杯のハードディスクの帯域幅を舐めてはいけない」
  — Andrew Tanenbaum

  10TB HDD × 100台 = 1PB
  翌日配送 (86400秒) → 約93 Gbps
  → インターネット経由より物理輸送の方が速い場合がある
  → AWS Snowball: 最大100PBの物理データ転送サービス
```

### 3.2 Webパフォーマンス予算

```
Webパフォーマンス予算の考え方:

  目標: 3Gモバイル (1.5Mbps) で3秒以内にLCP

  3秒 × 1.5Mbps = 4.5Mbit = 562KB の予算

  配分例:
  ┌──────────────┬───────────┬──────────┐
  │ リソース      │ 予算      │ 説明     │
  ├──────────────┼───────────┼──────────┤
  │ HTML         │ 30KB      │ gzip後   │
  │ CSS          │ 50KB      │ gzip後   │
  │ JavaScript   │ 200KB     │ gzip後   │
  │ フォント      │ 80KB      │ woff2    │
  │ 画像         │ 200KB     │ WebP/AVIF│
  │ 合計         │ 560KB     │ ≤ 予算   │
  └──────────────┴───────────┴──────────┘

  JavaScript 200KB (gzip) ≈ 800KB (非圧縮)
  → パース+コンパイル時間もボトルネックになる
  → モバイルCPUでは1MBのJSパースに 2-5秒
```

---

## 4. データセンター規模のスケール

### 4.1 主要サービスのデータ量

```
世界のデータ量（2024年時点の推定）:

  Google:
  - 検索インデックス: 約100PB+
  - Gmail: 約15EB+（30億ユーザー × 5GB）
  - YouTube: 1分あたり500時間のアップロード → 1日約720,000時間
  - Google Photos: 1日40億枚の写真がアップロード

  Meta:
  - Instagram: 1日1億枚以上の写真
  - WhatsApp: 1日1,000億通のメッセージ

  Netflix:
  - カタログ: 約10PB（全タイトル×全解像度×多言語）
  - CDN配信: ピーク時インターネット帯域の15%

  世界全体:
  - 2025年の年間データ生成量: 約180ZB（ゼタバイト）
  - 1ZB = 10^21 バイト = 1,000EB = 1,000,000PB
```

### 4.2 ストレージコスト

```
ストレージコスト (2024年):

  ┌─────────────────┬──────────────┬──────────────────┐
  │ メディア         │ $/TB/月      │ 用途              │
  ├─────────────────┼──────────────┼──────────────────┤
  │ RAMメモリ        │ $3,000       │ キャッシュ、DB     │
  │ NVMe SSD        │ $50          │ ホットデータ       │
  │ SATA SSD        │ $20          │ ウォームデータ     │
  │ HDD             │ $5           │ コールドデータ     │
  │ S3 Standard     │ $23          │ クラウドホット     │
  │ S3 IA           │ $12.5        │ クラウドウォーム   │
  │ S3 Glacier      │ $4           │ クラウドコールド   │
  │ S3 Deep Archive │ $1           │ アーカイブ        │
  │ テープ (LTO-9)  │ $0.5         │ 長期保存          │
  └─────────────────┴──────────────┴──────────────────┘

  階層型ストレージの設計:
  - 頻繁にアクセス（ホット）→ SSD / S3 Standard
  - たまにアクセス（ウォーム）→ HDD / S3 IA
  - ほぼアクセスなし（コールド）→ Glacier / テープ
  - 法令遵守のためだけに保持 → Deep Archive
```

---

## 5. 実践演習

### 演習1: 容量見積もり（基礎）
Instagram風の写真共有サービスを設計する。DAU 1000万人、1人平均3枚/日アップロード、1枚平均2MBの場合、1年間に必要なストレージ容量を算出せよ（レプリカ3倍、サムネイル生成含む）。

### 演習2: コスト計算（応用）
上記サービスのストレージを、ホット/ウォーム/コールドに階層化して設計し、年間コストを見積もれ。

### 演習3: 帯域幅設計（発展）
ピーク時のリクエストQPS、必要な帯域幅、CDNの設計を含めたインフラ構成を提案せよ。

---

## FAQ

### Q1: 「1GBのRAMで何件のレコードが保持できますか？」の見積もり方は？
**A**: レコードサイズを見積もる。例えばユーザーレコード（ID: 8B, 名前: 100B, メール: 100B, メタ: 100B）≈ 300B/レコード → 1GB / 300B ≈ 330万レコード。インデックスのオーバーヘッド（2-3倍）を考慮すると実質100万レコード程度。

### Q2: クラウドとオンプレのストレージコスト、どちらが安い？
**A**: 規模による。月数TB以下ならクラウドが安い（管理コスト削減）。PB規模ならオンプレが安い場合が多い（Netflix, Dropbox はオンプレに回帰した実例あり）。ただしオンプレには人件費、データセンター費用、電気代が加わる。

### Q3: 全てのデータを永遠に保持すべきですか？
**A**: いいえ。データ保持ポリシーを定めるべき。ログは90日〜1年、ユーザーデータは退会後一定期間（GDPR準拠）、バックアップは世代管理（日次7世代、週次4世代、月次12世代）。コストとコンプライアンスのバランスで決める。

---

## まとめ

| 概念 | ポイント |
|------|---------|
| テキスト | 日本語1文字≈3B。小説1冊≈300KB |
| 画像 | Web写真≈100-500KB。RAW≈25-50MB |
| 動画 | 1080p 1分≈35MB。4K 1分≈100MB |
| 見積もり | DAU×行動×データサイズ×レプリカ×保持期間 |
| コスト | RAM:$3000/TB/月 → SSD:$50 → HDD:$5 → テープ:$0.5 |

---

## 次に読むべきガイド
→ [[06-brain-vs-computer.md]] — 脳とコンピュータの比較

---

## 参考文献
1. Dean, J. "Numbers Every Programmer Should Know." Google, 2023 update.
2. Kleppmann, M. "Designing Data-Intensive Applications." O'Reilly, 2017.
3. Alex Xu. "System Design Interview." Chapter 2: Back-of-the-envelope Estimation.
4. AWS Pricing Calculator. https://calculator.aws/
