name: Weekly Documentation Update Check

on:
  schedule:
    # æ¯Žé€±é‡‘æ›œ 0:20 JST (æœ¨æ›œ 15:20 UTC)
    - cron: '20 15 * * 4'
  workflow_dispatch: # æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½

jobs:
  check-updates:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
      issues: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Check package versions
        id: version-check
        run: |
          # .doc-versions.json ã‹ã‚‰ç¾åœ¨ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’èª­ã¿è¾¼ã¿
          CURRENT_JEST=$(jq -r '.packages.jest.version' .doc-versions.json)
          CURRENT_PLAYWRIGHT=$(jq -r '.packages.playwright.version' .doc-versions.json)
          CURRENT_TYPESCRIPT=$(jq -r '.packages.typescript.version' .doc-versions.json)
          CURRENT_NEXTJS=$(jq -r '.packages.nextjs.version' .doc-versions.json)
          CURRENT_REACT=$(jq -r '.packages.react.version' .doc-versions.json)
          CURRENT_NODE=$(jq -r '.packages.nodejs.version' .doc-versions.json)

          # æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å–å¾—
          LATEST_JEST=$(npm view jest version)
          LATEST_PLAYWRIGHT=$(npm view playwright version)
          LATEST_TYPESCRIPT=$(npm view typescript version)
          LATEST_NEXTJS=$(npm view next version)
          LATEST_REACT=$(npm view react version)
          LATEST_NODE=$(curl -s https://nodejs.org/dist/index.json | jq -r '.[0].version' | sed 's/v//')

          # å‡ºåŠ›
          echo "jest_current=$CURRENT_JEST" >> $GITHUB_OUTPUT
          echo "jest_latest=$LATEST_JEST" >> $GITHUB_OUTPUT
          echo "playwright_current=$CURRENT_PLAYWRIGHT" >> $GITHUB_OUTPUT
          echo "playwright_latest=$LATEST_PLAYWRIGHT" >> $GITHUB_OUTPUT
          echo "typescript_current=$CURRENT_TYPESCRIPT" >> $GITHUB_OUTPUT
          echo "typescript_latest=$LATEST_TYPESCRIPT" >> $GITHUB_OUTPUT
          echo "nextjs_current=$CURRENT_NEXTJS" >> $GITHUB_OUTPUT
          echo "nextjs_latest=$LATEST_NEXTJS" >> $GITHUB_OUTPUT
          echo "react_current=$CURRENT_REACT" >> $GITHUB_OUTPUT
          echo "react_latest=$LATEST_REACT" >> $GITHUB_OUTPUT
          echo "node_current=$CURRENT_NODE" >> $GITHUB_OUTPUT
          echo "node_latest=$LATEST_NODE" >> $GITHUB_OUTPUT

          # å·®åˆ†ãŒã‚ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
          HAS_UPDATES=false
          if [ "$CURRENT_JEST" != "$LATEST_JEST" ]; then HAS_UPDATES=true; fi
          if [ "$CURRENT_PLAYWRIGHT" != "$LATEST_PLAYWRIGHT" ]; then HAS_UPDATES=true; fi
          if [ "$CURRENT_TYPESCRIPT" != "$LATEST_TYPESCRIPT" ]; then HAS_UPDATES=true; fi
          if [ "$CURRENT_NEXTJS" != "$LATEST_NEXTJS" ]; then HAS_UPDATES=true; fi
          if [ "$CURRENT_REACT" != "$LATEST_REACT" ]; then HAS_UPDATES=true; fi
          if [ "$CURRENT_NODE" != "$LATEST_NODE" ]; then HAS_UPDATES=true; fi

          echo "has_updates=$HAS_UPDATES" >> $GITHUB_OUTPUT

      - name: Fetch release notes
        if: steps.version-check.outputs.has_updates == 'true'
        id: release-notes
        run: |
          # Jest
          if [ "${{ steps.version-check.outputs.jest_current }}" != "${{ steps.version-check.outputs.jest_latest }}" ]; then
            JEST_RELEASE=$(curl -s https://api.github.com/repos/jestjs/jest/releases/latest)
            echo "jest_release_url=$(echo "$JEST_RELEASE" | jq -r '.html_url')" >> $GITHUB_OUTPUT
            echo "jest_release_body<<EOF" >> $GITHUB_OUTPUT
            echo "$JEST_RELEASE" | jq -r '.body' | head -20 >> $GITHUB_OUTPUT
            echo "EOF" >> $GITHUB_OUTPUT
          fi

          # Playwright
          if [ "${{ steps.version-check.outputs.playwright_current }}" != "${{ steps.version-check.outputs.playwright_latest }}" ]; then
            PLAYWRIGHT_RELEASE=$(curl -s https://api.github.com/repos/microsoft/playwright/releases/latest)
            echo "playwright_release_url=$(echo "$PLAYWRIGHT_RELEASE" | jq -r '.html_url')" >> $GITHUB_OUTPUT
            echo "playwright_release_body<<EOF" >> $GITHUB_OUTPUT
            echo "$PLAYWRIGHT_RELEASE" | jq -r '.body' | head -20 >> $GITHUB_OUTPUT
            echo "EOF" >> $GITHUB_OUTPUT
          fi

          # TypeScript
          if [ "${{ steps.version-check.outputs.typescript_current }}" != "${{ steps.version-check.outputs.typescript_latest }}" ]; then
            TYPESCRIPT_RELEASE=$(curl -s https://api.github.com/repos/microsoft/TypeScript/releases/latest)
            echo "typescript_release_url=$(echo "$TYPESCRIPT_RELEASE" | jq -r '.html_url')" >> $GITHUB_OUTPUT
          fi

      - name: Analyze release notes with Claude API
        if: steps.version-check.outputs.has_updates == 'true'
        id: claude-analysis
        env:
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
        run: |
          # Claude APIã§ãƒªãƒªãƒ¼ã‚¹ãƒŽãƒ¼ãƒˆã‚’è©³ç´°åˆ†æž

          # Jestã®åˆ†æž
          if [ "${{ steps.version-check.outputs.jest_current }}" != "${{ steps.version-check.outputs.jest_latest }}" ]; then
            # ãƒªãƒªãƒ¼ã‚¹ãƒŽãƒ¼ãƒˆã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜
            cat > /tmp/jest_release.txt <<'RELEASE_EOF'
          ${{ steps.release-notes.outputs.jest_release_body }}
          RELEASE_EOF

            # jqã§JSONåŒ–ã—ã¦APIãƒªã‚¯ã‚¨ã‚¹ãƒˆ
            PROMPT="ä»¥ä¸‹ã¯Jestã®ãƒªãƒªãƒ¼ã‚¹ãƒŽãƒ¼ãƒˆã§ã™ã€‚ã“ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚’åˆ†æžã—ã¦ãã ã•ã„ï¼š\n\n$(cat /tmp/jest_release.txt)\n\nä»¥ä¸‹ã®å½¢å¼ã§å›žç­”ã—ã¦ãã ã•ã„ï¼š\n1. ç ´å£Šçš„å¤‰æ›´: ã‚ã‚Š/ãªã—\n2. é‡è¦åº¦: é«˜/ä¸­/ä½Ž\n3. å½±éŸ¿ç¯„å›²: ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰/è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«/ãã®ä»–\n4. æŽ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: å…·ä½“çš„ã«ä½•ã‚’ã™ã¹ãã‹\n5. æ¦‚è¦: å¤‰æ›´å†…å®¹ã‚’3è¡Œã§è¦ç´„"

            REQUEST_BODY=$(jq -n \
              --arg model "claude-3-5-sonnet-20241022" \
              --argjson max_tokens 2000 \
              --arg content "$PROMPT" \
              '{model: $model, max_tokens: $max_tokens, messages: [{role: "user", content: $content}]}')

            JEST_ANALYSIS=$(curl -s https://api.anthropic.com/v1/messages \
              -H "x-api-key: $ANTHROPIC_API_KEY" \
              -H "anthropic-version: 2023-06-01" \
              -H "content-type: application/json" \
              -d "$REQUEST_BODY" | jq -r '.content[0].text')

            echo "jest_analysis<<EOF" >> $GITHUB_OUTPUT
            echo "$JEST_ANALYSIS" >> $GITHUB_OUTPUT
            echo "EOF" >> $GITHUB_OUTPUT
          fi

          # Playwrightã®åˆ†æž
          if [ "${{ steps.version-check.outputs.playwright_current }}" != "${{ steps.version-check.outputs.playwright_latest }}" ]; then
            # ãƒªãƒªãƒ¼ã‚¹ãƒŽãƒ¼ãƒˆã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜
            cat > /tmp/playwright_release.txt <<'RELEASE_EOF'
          ${{ steps.release-notes.outputs.playwright_release_body }}
          RELEASE_EOF

            # jqã§JSONåŒ–ã—ã¦APIãƒªã‚¯ã‚¨ã‚¹ãƒˆ
            PROMPT="ä»¥ä¸‹ã¯Playwrightã®ãƒªãƒªãƒ¼ã‚¹ãƒŽãƒ¼ãƒˆã§ã™ã€‚ã“ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚’åˆ†æžã—ã¦ãã ã•ã„ï¼š\n\n$(cat /tmp/playwright_release.txt)\n\nä»¥ä¸‹ã®å½¢å¼ã§å›žç­”ã—ã¦ãã ã•ã„ï¼š\n1. ç ´å£Šçš„å¤‰æ›´: ã‚ã‚Š/ãªã—\n2. é‡è¦åº¦: é«˜/ä¸­/ä½Ž\n3. å½±éŸ¿ç¯„å›²: ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰/è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«/ãã®ä»–\n4. æŽ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: å…·ä½“çš„ã«ä½•ã‚’ã™ã¹ãã‹\n5. æ¦‚è¦: å¤‰æ›´å†…å®¹ã‚’3è¡Œã§è¦ç´„"

            REQUEST_BODY=$(jq -n \
              --arg model "claude-3-5-sonnet-20241022" \
              --argjson max_tokens 2000 \
              --arg content "$PROMPT" \
              '{model: $model, max_tokens: $max_tokens, messages: [{role: "user", content: $content}]}')

            PLAYWRIGHT_ANALYSIS=$(curl -s https://api.anthropic.com/v1/messages \
              -H "x-api-key: $ANTHROPIC_API_KEY" \
              -H "anthropic-version: 2023-06-01" \
              -H "content-type: application/json" \
              -d "$REQUEST_BODY" | jq -r '.content[0].text')

            echo "playwright_analysis<<EOF" >> $GITHUB_OUTPUT
            echo "$PLAYWRIGHT_ANALYSIS" >> $GITHUB_OUTPUT
            echo "EOF" >> $GITHUB_OUTPUT
          fi

      - name: Check for breaking changes
        if: steps.version-check.outputs.has_updates == 'true'
        id: breaking-check
        run: |
          # Claudeåˆ†æžçµæžœã‹ã‚‰ç ´å£Šçš„å¤‰æ›´ã‚’æ¤œçŸ¥
          HAS_BREAKING=false

          # Jest
          if [ "${{ steps.version-check.outputs.jest_current }}" != "${{ steps.version-check.outputs.jest_latest }}" ]; then
            # Claudeåˆ†æžçµæžœã‚’ãƒã‚§ãƒƒã‚¯
            if echo "${{ steps.claude-analysis.outputs.jest_analysis }}" | grep -iE "ç ´å£Šçš„å¤‰æ›´.*ã‚ã‚Š" > /dev/null; then
              HAS_BREAKING=true
              echo "jest_breaking=true" >> $GITHUB_OUTPUT
            # ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒžãƒƒãƒãƒ³ã‚°
            elif echo "${{ steps.release-notes.outputs.jest_release_body }}" | grep -iE "(breaking|breaking change|migration)" > /dev/null; then
              HAS_BREAKING=true
              echo "jest_breaking=true" >> $GITHUB_OUTPUT
            fi
          fi

          # Playwright
          if [ "${{ steps.version-check.outputs.playwright_current }}" != "${{ steps.version-check.outputs.playwright_latest }}" ]; then
            # Claudeåˆ†æžçµæžœã‚’ãƒã‚§ãƒƒã‚¯
            if echo "${{ steps.claude-analysis.outputs.playwright_analysis }}" | grep -iE "ç ´å£Šçš„å¤‰æ›´.*ã‚ã‚Š" > /dev/null; then
              HAS_BREAKING=true
              echo "playwright_breaking=true" >> $GITHUB_OUTPUT
            # ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒžãƒƒãƒãƒ³ã‚°
            elif echo "${{ steps.release-notes.outputs.playwright_release_body }}" | grep -iE "(breaking|breaking change|migration)" > /dev/null; then
              HAS_BREAKING=true
              echo "playwright_breaking=true" >> $GITHUB_OUTPUT
            fi
          fi

          echo "has_breaking=$HAS_BREAKING" >> $GITHUB_OUTPUT

      - name: Update UPDATES.md
        if: steps.version-check.outputs.has_updates == 'true'
        run: |
          DATE=$(date +%Y-%m-%d)

          cat >> UPDATES.md <<EOF

          ---

          ## $DATE (è‡ªå‹•æ¤œå‡º)

          ### ðŸ”„ ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–°æ¤œçŸ¥

          EOF

          # Jest
          if [ "${{ steps.version-check.outputs.jest_current }}" != "${{ steps.version-check.outputs.jest_latest }}" ]; then
            cat >> UPDATES.md <<EOF

          #### Jest
          - **ç¾åœ¨ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ:** ${{ steps.version-check.outputs.jest_current }}
          - **æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³:** ${{ steps.version-check.outputs.jest_latest }}
          - **ãƒªãƒªãƒ¼ã‚¹ãƒŽãƒ¼ãƒˆ:** ${{ steps.release-notes.outputs.jest_release_url }}
          EOF
            if [ "${{ steps.breaking-check.outputs.jest_breaking }}" == "true" ]; then
              echo "- âš ï¸ **ç ´å£Šçš„å¤‰æ›´ã®å¯èƒ½æ€§ã‚ã‚Š**" >> UPDATES.md
            fi
            cat >> UPDATES.md <<EOF
          - **å½±éŸ¿ç¯„å›²:**
            - testing-strategy/guides/unit/unit-testing-complete.md
            - ci-cd-automation/guides/quality/quality-automation-complete.md

          **Claudeåˆ†æžçµæžœ:**
          \`\`\`
          ${{ steps.claude-analysis.outputs.jest_analysis }}
          \`\`\`

          EOF
          fi

          # Playwright
          if [ "${{ steps.version-check.outputs.playwright_current }}" != "${{ steps.version-check.outputs.playwright_latest }}" ]; then
            cat >> UPDATES.md <<EOF

          #### Playwright
          - **ç¾åœ¨ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ:** ${{ steps.version-check.outputs.playwright_current }}
          - **æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³:** ${{ steps.version-check.outputs.playwright_latest }}
          - **ãƒªãƒªãƒ¼ã‚¹ãƒŽãƒ¼ãƒˆ:** ${{ steps.release-notes.outputs.playwright_release_url }}
          EOF
            if [ "${{ steps.breaking-check.outputs.playwright_breaking }}" == "true" ]; then
              echo "- âš ï¸ **ç ´å£Šçš„å¤‰æ›´ã®å¯èƒ½æ€§ã‚ã‚Š**" >> UPDATES.md
            fi
            cat >> UPDATES.md <<EOF
          - **å½±éŸ¿ç¯„å›²:**
            - testing-strategy/guides/e2e/e2e-testing-complete.md

          **Claudeåˆ†æžçµæžœ:**
          \`\`\`
          ${{ steps.claude-analysis.outputs.playwright_analysis }}
          \`\`\`

          EOF
          fi

          # TypeScript
          if [ "${{ steps.version-check.outputs.typescript_current }}" != "${{ steps.version-check.outputs.typescript_latest }}" ]; then
            cat >> UPDATES.md <<EOF

          #### TypeScript
          - **ç¾åœ¨ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ:** ${{ steps.version-check.outputs.typescript_current }}
          - **æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³:** ${{ steps.version-check.outputs.typescript_latest }}
          - **ãƒªãƒªãƒ¼ã‚¹ãƒŽãƒ¼ãƒˆ:** ${{ steps.release-notes.outputs.typescript_release_url }}
          - **å½±éŸ¿ç¯„å›²:**
            - backend-development/guides/typescript/typescript-backend-complete.md
            - nodejs-development/guides/typescript/typescript-patterns-complete.md

          EOF
          fi

          # Next.js
          if [ "${{ steps.version-check.outputs.nextjs_current }}" != "${{ steps.version-check.outputs.nextjs_latest }}" ]; then
            cat >> UPDATES.md <<EOF

          #### Next.js
          - **ç¾åœ¨ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ:** ${{ steps.version-check.outputs.nextjs_current }}
          - **æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³:** ${{ steps.version-check.outputs.nextjs_latest }}
          - **ãƒªãƒªãƒ¼ã‚¹ãƒŽãƒ¼ãƒˆ:** https://github.com/vercel/next.js/releases
          - **å½±éŸ¿ç¯„å›²:**
            - nextjs-development/guides/* (å…¨ãƒ•ã‚¡ã‚¤ãƒ«)

          EOF
          fi

          # React
          if [ "${{ steps.version-check.outputs.react_current }}" != "${{ steps.version-check.outputs.react_latest }}" ]; then
            cat >> UPDATES.md <<EOF

          #### React
          - **ç¾åœ¨ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ:** ${{ steps.version-check.outputs.react_current }}
          - **æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³:** ${{ steps.version-check.outputs.react_latest }}
          - **ãƒªãƒªãƒ¼ã‚¹ãƒŽãƒ¼ãƒˆ:** https://github.com/facebook/react/releases
          - **å½±éŸ¿ç¯„å›²:**
            - react-development/guides/* (å…¨ãƒ•ã‚¡ã‚¤ãƒ«)

          EOF
          fi

          # Node.js
          if [ "${{ steps.version-check.outputs.node_current }}" != "${{ steps.version-check.outputs.node_latest }}" ]; then
            cat >> UPDATES.md <<EOF

          #### Node.js
          - **ç¾åœ¨ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ:** ${{ steps.version-check.outputs.node_current }}
          - **æœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³:** ${{ steps.version-check.outputs.node_latest }}
          - **ãƒªãƒªãƒ¼ã‚¹ãƒŽãƒ¼ãƒˆ:** https://nodejs.org/en/blog/release/
          - **å½±éŸ¿ç¯„å›²:**
            - nodejs-development/guides/* (å…¨ãƒ•ã‚¡ã‚¤ãƒ«)
            - backend-development/guides/* (å…¨ãƒ•ã‚¡ã‚¤ãƒ«)

          EOF
          fi

          cat >> UPDATES.md <<EOF

          ### ðŸ“‹ æŽ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
          - [ ] ä¸Šè¨˜ãƒªãƒªãƒ¼ã‚¹ãƒŽãƒ¼ãƒˆã‚’ç¢ºèª
          - [ ] å½±éŸ¿ç¯„å›²ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°
          - [ ] .doc-versions.json ã‚’æ›´æ–°
          - [ ] ã“ã®PRã‚’ãƒžãƒ¼ã‚¸

          EOF

      - name: Update .doc-versions.json
        if: steps.version-check.outputs.has_updates == 'true'
        run: |
          # lastUpdatedã‚’æ›´æ–°
          jq '.lastUpdated = "'$(date +%Y-%m-%d)'"' .doc-versions.json > .doc-versions.json.tmp
          mv .doc-versions.json.tmp .doc-versions.json

          # æ¤œå‡ºã•ã‚ŒãŸæ›´æ–°ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã¨ã—ã¦è¿½è¨˜ï¼ˆæ‰‹å‹•æ›´æ–°ã‚’ä¿ƒã™ï¼‰
          DATE=$(date +%Y-%m-%d)
          echo "" >> .doc-versions.json
          echo "// [$DATE] æ›´æ–°æ¤œçŸ¥: Jest ${{ steps.version-check.outputs.jest_latest }}, Playwright ${{ steps.version-check.outputs.playwright_latest }}" >> .doc-versions.json
          echo "// ä¸Šè¨˜ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«æ›´æ–°ã™ã‚‹å ´åˆã¯ã€è©²å½“è¡Œã‚’æ‰‹å‹•ã§ç·¨é›†ã—ã¦ãã ã•ã„" >> .doc-versions.json

      - name: Create Pull Request
        if: steps.version-check.outputs.has_updates == 'true'
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: |
            ðŸ“¦ Weekly update check - ${{ github.run_number }}

            Detected version updates. See UPDATES.md for details.
          branch: docs/auto-update-${{ github.run_number }}
          delete-branch: true
          draft: true
          title: 'ðŸ“¦ Weekly Documentation Update Check - ${{ github.run_number }}'
          body: |
            ## ðŸ¤– è‡ªå‹•ç”ŸæˆPR

            é€±æ¬¡ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯ã§æ›´æ–°ã‚’æ¤œçŸ¥ã—ã¾ã—ãŸã€‚

            ### æ¤œçŸ¥ã•ã‚ŒãŸæ›´æ–°

            ${{ steps.version-check.outputs.jest_current != steps.version-check.outputs.jest_latest && format('- **Jest:** {0} â†’ {1}', steps.version-check.outputs.jest_current, steps.version-check.outputs.jest_latest) || '' }}
            ${{ steps.version-check.outputs.playwright_current != steps.version-check.outputs.playwright_latest && format('- **Playwright:** {0} â†’ {1}', steps.version-check.outputs.playwright_current, steps.version-check.outputs.playwright_latest) || '' }}
            ${{ steps.version-check.outputs.typescript_current != steps.version-check.outputs.typescript_latest && format('- **TypeScript:** {0} â†’ {1}', steps.version-check.outputs.typescript_current, steps.version-check.outputs.typescript_latest) || '' }}
            ${{ steps.version-check.outputs.nextjs_current != steps.version-check.outputs.nextjs_latest && format('- **Next.js:** {0} â†’ {1}', steps.version-check.outputs.nextjs_current, steps.version-check.outputs.nextjs_latest) || '' }}
            ${{ steps.version-check.outputs.react_current != steps.version-check.outputs.react_latest && format('- **React:** {0} â†’ {1}', steps.version-check.outputs.react_current, steps.version-check.outputs.react_latest) || '' }}
            ${{ steps.version-check.outputs.node_current != steps.version-check.outputs.node_latest && format('- **Node.js:** {0} â†’ {1}', steps.version-check.outputs.node_current, steps.version-check.outputs.node_latest) || '' }}

            ### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

            1. `UPDATES.md` ã‚’ç¢ºèª
            2. ãƒªãƒªãƒ¼ã‚¹ãƒŽãƒ¼ãƒˆã‚’ç¢ºèª
            3. å¿…è¦ã«å¿œã˜ã¦ã‚¬ã‚¤ãƒ‰ã‚’æ›´æ–°
            4. `.doc-versions.json` ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æ‰‹å‹•æ›´æ–°
            5. ã“ã®PRã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»ãƒžãƒ¼ã‚¸

            è©³ç´°ã¯ `UPDATES.md` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

            ---
            ðŸ¤– è‡ªå‹•ç”Ÿæˆ by [weekly-update-check.yml](.github/workflows/weekly-update-check.yml)

      - name: Create Issue for breaking changes
        if: steps.breaking-check.outputs.has_breaking == 'true'
        uses: actions/github-script@v7
        with:
          script: |
            await github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: 'âš ï¸ ç ´å£Šçš„å¤‰æ›´ã®å¯èƒ½æ€§ - ç·Šæ€¥ç¢ºèª',
              body: `## âš ï¸ ç ´å£Šçš„å¤‰æ›´æ¤œçŸ¥

            é€±æ¬¡ãƒã‚§ãƒƒã‚¯ã§ç ´å£Šçš„å¤‰æ›´ã®å¯èƒ½æ€§ãŒã‚ã‚‹æ›´æ–°ã‚’æ¤œçŸ¥ã—ã¾ã—ãŸã€‚

            ### è©²å½“ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

            ${{ steps.breaking-check.outputs.jest_breaking == 'true' && '- Jest' || '' }}
            ${{ steps.breaking-check.outputs.playwright_breaking == 'true' && '- Playwright' || '' }}

            ### å¯¾å¿œãŒå¿…è¦ãªç†ç”±

            ç ´å£Šçš„å¤‰æ›´ã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã‚³ãƒ¼ãƒ‰ä¾‹ãŒå‹•ã‹ãªããªã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

            ### æŽ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

            1. ãƒªãƒªãƒ¼ã‚¹ãƒŽãƒ¼ãƒˆã‚’è©³ç´°ç¢ºèª
            2. å½±éŸ¿ç¯„å›²ã®ã‚¬ã‚¤ãƒ‰ã‚’å…¨ã¦ç¢ºèª
            3. ã‚³ãƒ¼ãƒ‰ä¾‹ã‚’ä¿®æ­£
            4. å¤‰æ›´å±¥æ­´ã«è¨˜è¼‰

            è©³ç´°ã¯ [UPDATES.md](./UPDATES.md) ãŠã‚ˆã³é–¢é€£PRã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

            ---
            ðŸ¤– è‡ªå‹•ç”Ÿæˆ by weekly-update-check.yml`,
              labels: ['documentation', 'urgent', 'breaking-change']
            });

      - name: Summary
        if: steps.version-check.outputs.has_updates == 'true'
        run: |
          echo "### ðŸ“¦ é€±æ¬¡æ›´æ–°ãƒã‚§ãƒƒã‚¯å®Œäº†" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**æ¤œçŸ¥ã•ã‚ŒãŸæ›´æ–°:**" >> $GITHUB_STEP_SUMMARY
          echo "- Jest: ${{ steps.version-check.outputs.jest_current }} â†’ ${{ steps.version-check.outputs.jest_latest }}" >> $GITHUB_STEP_SUMMARY
          echo "- Playwright: ${{ steps.version-check.outputs.playwright_current }} â†’ ${{ steps.version-check.outputs.playwright_latest }}" >> $GITHUB_STEP_SUMMARY
          echo "- TypeScript: ${{ steps.version-check.outputs.typescript_current }} â†’ ${{ steps.version-check.outputs.typescript_latest }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Draft PRä½œæˆ:** ä½œæˆã•ã‚ŒãŸPRã‚’ç¢ºèªã—ã¦ãã ã•ã„" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          if [ "${{ steps.breaking-check.outputs.has_breaking }}" == "true" ]; then
            echo "âš ï¸ **ç ´å£Šçš„å¤‰æ›´ã®å¯èƒ½æ€§ã‚ã‚Š - Issueã‚’ä½œæˆã—ã¾ã—ãŸ**" >> $GITHUB_STEP_SUMMARY
          fi

      - name: No updates summary
        if: steps.version-check.outputs.has_updates == 'false'
        run: |
          echo "### âœ… å…¨ã¦æœ€æ–°" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯å…¨ã¦æœ€æ–°ã®çŠ¶æ…‹ã§ã™ã€‚" >> $GITHUB_STEP_SUMMARY
