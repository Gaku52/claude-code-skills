# IPアドレッシング

> IPアドレスはインターネット上の「住所」。IPv4/IPv6、サブネット、CIDR、NAT、DHCPを理解して、ネットワーク設計の基盤を固める。

## この章で学ぶこと

- [ ] IPv4とIPv6の仕組みと違いを理解する
- [ ] サブネットとCIDR表記を把握する
- [ ] NATとDHCPの役割を学ぶ

---

## 1. IPv4

```
IPv4 アドレス:
  → 32ビット（4バイト）
  → ドット区切り10進表記: 192.168.1.100
  → 約43億個（2^32）→ 枯渇問題

  192   . 168   . 1     . 100
  11000000.10101000.00000001.01100100

特殊なアドレス:
  127.0.0.1     — ループバック（localhost）
  0.0.0.0       — 全てのインターフェース
  255.255.255.255 — ブロードキャスト
  10.0.0.0/8    — プライベート（Class A）
  172.16.0.0/12 — プライベート（Class B）
  192.168.0.0/16 — プライベート（Class C）
```

---

## 2. サブネットとCIDR

```
CIDR（Classless Inter-Domain Routing）:
  192.168.1.0/24
    → /24 = 最初の24ビットがネットワーク部
    → 残り8ビットがホスト部
    → 使用可能ホスト数: 2^8 - 2 = 254

  サブネットマスク:
  /24 → 255.255.255.0   → 254ホスト
  /16 → 255.255.0.0     → 65,534ホスト
  /8  → 255.0.0.0       → 16,777,214ホスト

  例: 192.168.1.0/24
  ネットワークアドレス: 192.168.1.0
  ブロードキャスト:     192.168.1.255
  使用可能範囲:         192.168.1.1 〜 192.168.1.254

  VPCの設計例（AWS）:
  VPC:     10.0.0.0/16    （65,536アドレス）
  ├── Public:  10.0.1.0/24  （256アドレス）
  ├── Private: 10.0.2.0/24  （256アドレス）
  └── DB:      10.0.3.0/24  （256アドレス）
```

---

## 3. IPv6

```
IPv6 アドレス:
  → 128ビット（16バイト）
  → コロン区切り16進表記: 2001:0db8:85a3:0000:0000:8a2e:0370:7334
  → 約3.4×10^38個 → 事実上枯渇しない

省略ルール:
  2001:0db8:0000:0000:0000:0000:0000:0001
  → 2001:db8::1（連続する0を :: で省略）

特殊アドレス:
  ::1         — ループバック（IPv4の127.0.0.1に相当）
  ::          — 未指定アドレス
  fe80::/10   — リンクローカル
  2000::/3    — グローバルユニキャスト

IPv4 → IPv6 移行:
  → デュアルスタック: IPv4 と IPv6 を同時運用
  → トンネリング: IPv6パケットをIPv4で包む
  → NAT64: IPv6 → IPv4 変換
```

---

## 4. NAT（Network Address Translation）

```
NAT = プライベートIPとグローバルIPの変換

  プライベートネットワーク              インターネット
  ┌──────────────┐                    ┌──────────────┐
  │ PC1: 192.168.1.10 │               │              │
  │ PC2: 192.168.1.11 │──→ [NAT] ──→ │ 203.0.113.1  │
  │ PC3: 192.168.1.12 │    ルーター   │ (グローバルIP)│
  └──────────────┘                    └──────────────┘

  NAT変換テーブル:
  内部 192.168.1.10:54321 ↔ 外部 203.0.113.1:10001
  内部 192.168.1.11:54322 ↔ 外部 203.0.113.1:10002

利点:
  ✓ IPv4アドレスの節約
  ✓ 内部ネットワークの隠蔽（セキュリティ）

欠点:
  ✗ P2P通信が困難
  ✗ 外部からの接続開始が不可（ポートフォワーディング必要）
```

---

## 5. DHCP

```
DHCP（Dynamic Host Configuration Protocol）:
  → IPアドレスを自動的に割り当てる

  1. Discover: クライアント → ブロードキャスト「IPアドレスください」
  2. Offer:    DHCPサーバー → 「192.168.1.100 を使っていいよ」
  3. Request:  クライアント → 「192.168.1.100 を使います」
  4. Ack:      DHCPサーバー → 「了解。リース期間は24時間」

  割り当て情報:
  - IPアドレス
  - サブネットマスク
  - デフォルトゲートウェイ
  - DNSサーバー
  - リース期間
```

---

## まとめ

| 概念 | ポイント |
|------|---------|
| IPv4 | 32ビット、約43億個、枯渇 |
| IPv6 | 128ビット、事実上無限 |
| CIDR | /24 = 254ホスト |
| NAT | プライベート ↔ グローバル変換 |
| DHCP | IPアドレスの自動割り当て |

---

## 次に読むべきガイド
→ [[03-dns.md]] — DNS

---

## 参考文献
1. RFC 791. "Internet Protocol." IETF, 1981.
2. RFC 8200. "Internet Protocol, Version 6." IETF, 2017.
