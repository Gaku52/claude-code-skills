# OSI参照モデルとTCP/IPモデル

> ネットワーク通信を「層」に分けて理解するモデル。OSI 7層モデルは理論、TCP/IP 4層モデルは実践。各層の役割とプロトコルの対応関係を把握する。

## この章で学ぶこと

- [ ] OSI 7層モデルの各層の役割を理解する
- [ ] TCP/IP 4層モデルとの対応関係を把握する
- [ ] 各層の代表的なプロトコルを学ぶ

---

## 1. OSI参照モデル（7層）

```
┌─────┬──────────────────┬──────────────────────────────────┐
│ 層  │ 名称             │ 役割                             │
├─────┼──────────────────┼──────────────────────────────────┤
│  7  │ アプリケーション │ ユーザーに直接サービスを提供     │
│     │                  │ HTTP, FTP, SMTP, DNS             │
├─────┼──────────────────┼──────────────────────────────────┤
│  6  │ プレゼンテーション│ データの表現形式（暗号化/圧縮）  │
│     │                  │ TLS/SSL, JPEG, UTF-8             │
├─────┼──────────────────┼──────────────────────────────────┤
│  5  │ セッション       │ 通信の開始/終了/管理             │
│     │                  │ NetBIOS, RPC                     │
├─────┼──────────────────┼──────────────────────────────────┤
│  4  │ トランスポート   │ 端末間の信頼性ある通信           │
│     │                  │ TCP, UDP                         │
├─────┼──────────────────┼──────────────────────────────────┤
│  3  │ ネットワーク     │ ルーティング（経路選択）         │
│     │                  │ IP, ICMP, ARP                    │
├─────┼──────────────────┼──────────────────────────────────┤
│  2  │ データリンク     │ 隣接ノード間の通信               │
│     │                  │ Ethernet, Wi-Fi, PPP             │
├─────┼──────────────────┼──────────────────────────────────┤
│  1  │ 物理             │ 電気/光信号の伝送               │
│     │                  │ ケーブル, 光ファイバー, 無線     │
└─────┴──────────────────┴──────────────────────────────────┘
```

---

## 2. TCP/IP モデル（4層）

```
┌────────────────────┬─────────────────┬──────────────────┐
│ TCP/IP モデル      │ OSI 対応        │ プロトコル例     │
├────────────────────┼─────────────────┼──────────────────┤
│ アプリケーション層 │ 7 + 6 + 5       │ HTTP, DNS, SMTP  │
│                    │                 │ FTP, SSH, TLS    │
├────────────────────┼─────────────────┼──────────────────┤
│ トランスポート層   │ 4               │ TCP, UDP         │
├────────────────────┼─────────────────┼──────────────────┤
│ インターネット層   │ 3               │ IP, ICMP, ARP    │
├────────────────────┼─────────────────┼──────────────────┤
│ ネットワーク       │ 2 + 1           │ Ethernet, Wi-Fi  │
│ インターフェース層 │                 │                  │
└────────────────────┴─────────────────┴──────────────────┘

実務では TCP/IP モデルが主流:
  → OSI は理論的な参照モデル
  → TCP/IP は実際のインターネットの構造
```

---

## 3. カプセル化

```
データが各層を通過する際の変化:

  アプリケーション層:
    [HTTP データ]

  トランスポート層:
    [TCP ヘッダー][HTTP データ]  ← セグメント

  インターネット層:
    [IP ヘッダー][TCP ヘッダー][HTTP データ]  ← パケット

  ネットワーク層:
    [Eth ヘッダー][IP][TCP][HTTP データ][Eth FCS]  ← フレーム

  物理層:
    01101001 10110010 ...  ← ビット列

  送信側: データにヘッダーを追加（カプセル化）
  受信側: ヘッダーを除去して上位層に渡す（非カプセル化）
```

---

## 4. 各層のヘッダー

```
Ethernet フレームヘッダー（L2）:
  宛先MAC: 00:1A:2B:3C:4D:5E（48ビット）
  送信元MAC: 00:6F:7G:8H:9I:0J
  タイプ: 0x0800（IPv4）

IP パケットヘッダー（L3）:
  バージョン: 4（IPv4）
  TTL: 64（ホップ数制限）
  プロトコル: 6（TCP）
  送信元IP: 192.168.1.100
  宛先IP: 93.184.216.34

TCP セグメントヘッダー（L4）:
  送信元ポート: 54321
  宛先ポート: 443
  シーケンス番号: 12345
  ACK番号: 67890
  フラグ: SYN, ACK, FIN, RST
  ウィンドウサイズ: 65535
```

---

## 5. よく使うポート番号

```
┌────────┬──────────────────┬─────────────────┐
│ ポート │ プロトコル       │ 用途            │
├────────┼──────────────────┼─────────────────┤
│ 20, 21 │ FTP              │ ファイル転送    │
│ 22     │ SSH              │ セキュアシェル  │
│ 25     │ SMTP             │ メール送信      │
│ 53     │ DNS              │ 名前解決        │
│ 80     │ HTTP             │ Web（非暗号化） │
│ 443    │ HTTPS            │ Web（暗号化）   │
│ 3000   │ 開発サーバー     │ Node.js等       │
│ 3306   │ MySQL            │ データベース    │
│ 5432   │ PostgreSQL       │ データベース    │
│ 6379   │ Redis            │ キャッシュ      │
│ 8080   │ HTTP代替         │ プロキシ/開発   │
│ 27017  │ MongoDB          │ データベース    │
└────────┴──────────────────┴─────────────────┘

ポート番号の範囲:
  0-1023:     ウェルノウンポート（root権限が必要）
  1024-49151: レジスタードポート
  49152-65535: ダイナミック/エフェメラルポート
```

---

## まとめ

| 層 | 役割 | 代表プロトコル |
|----|------|---------------|
| アプリケーション | サービス提供 | HTTP, DNS, TLS |
| トランスポート | 信頼性 | TCP, UDP |
| インターネット | ルーティング | IP, ICMP |
| ネットワーク | 物理伝送 | Ethernet, Wi-Fi |

---

## 次に読むべきガイド
→ [[02-ip-addressing.md]] — IPアドレッシング

---

## 参考文献
1. Tanenbaum, A. "Computer Networks." 6th Ed, Pearson, 2021.
2. RFC 1122. "Requirements for Internet Hosts."
