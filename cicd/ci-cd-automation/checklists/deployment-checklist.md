# デプロイメントチェックリスト

## デプロイ前確認

### コード品質
- [ ] 全てのテストがパス
- [ ] Lintエラーがゼロ
- [ ] 型チェックエラーがゼロ
- [ ] コードレビュー完了
- [ ] マージコンフリクト解消済み

### ビルド確認
- [ ] ローカルビルドが成功
- [ ] CI/CDビルドが成功
- [ ] ビルドサイズの確認（大幅な増加がないか）
- [ ] バンドル分析実施（Web）
- [ ] 不要な依存関係の削除確認

### 環境変数
- [ ] 全ての環境変数が設定済み
- [ ] 本番環境用の値に更新
- [ ] APIエンドポイントの確認
- [ ] データベースURL確認
- [ ] サードパーティキーの有効性確認

### データベース
- [ ] マイグレーション実行計画
- [ ] バックアップ取得済み
- [ ] ロールバック手順確認
- [ ] インデックス追加の必要性確認
- [ ] パフォーマンステスト完了

---

## Web アプリケーション

### フロントエンド
- [ ] 本番ビルドの動作確認
- [ ] 環境変数の確認（`NEXT_PUBLIC_*`等）
- [ ] アセット最適化（画像、フォント等）
- [ ] Service Worker更新確認（PWA）
- [ ] Analytics/モニタリングコード確認

### バックエンド
- [ ] APIエンドポイント確認
- [ ] レート制限設定
- [ ] CORS設定確認
- [ ] ヘルスチェックエンドポイント動作確認
- [ ] ログ設定確認

### インフラ
- [ ] CDN設定確認（Cloudflare, CloudFront等）
- [ ] SSL証明書有効期限確認
- [ ] ドメイン設定確認
- [ ] キャッシュ設定確認
- [ ] スケーリング設定確認

---

## iOS アプリケーション

### ビルド前
- [ ] Xcodeバージョン確認
- [ ] 証明書・プロビジョニングプロファイル確認
- [ ] Bundle IDの確認
- [ ] バージョン番号・ビルド番号の更新
- [ ] Info.plist設定確認

### テスト
- [ ] ユニットテスト全パス
- [ ] UIテスト実行
- [ ] 実機テスト完了
- [ ] パフォーマンステスト実施
- [ ] メモリリーク確認

### App Store準備
- [ ] スクリーンショット準備（全サイズ）
- [ ] アプリ説明文・リリースノート準備
- [ ] プライバシーポリシー更新
- [ ] App Store Connect設定確認
- [ ] レビューノート準備

### TestFlight配布前
- [ ] 内部テスター登録
- [ ] 外部テスター登録
- [ ] テストグループ設定
- [ ] フィードバック収集方法確認

---

## Android アプリケーション

### ビルド前
- [ ] Gradle設定確認
- [ ] 署名鍵確認
- [ ] versionCode/versionName更新
- [ ] ProGuard/R8設定確認
- [ ] 権限設定確認（AndroidManifest.xml）

### テスト
- [ ] ユニットテスト全パス
- [ ] Instrumentation テスト実行
- [ ] 複数デバイスでテスト
- [ ] APKサイズ確認
- [ ] 起動時間測定

### Google Play準備
- [ ] スクリーンショット準備
- [ ] アプリ説明文準備
- [ ] リリーストラック選択（Internal, Alpha, Beta, Production）
- [ ] 段階的公開設定
- [ ] Google Play Console設定確認

---

## デプロイ実行

### 手動デプロイ
```bash
# 1. 最新コードを取得
git checkout main
git pull origin main

# 2. ビルド
npm run build

# 3. デプロイ
npm run deploy  # または Vercel, AWS等のCLI

# 4. デプロイ確認
curl https://your-app.com/health
```

### CI/CDデプロイ
- [ ] ワークフローの手動トリガー実行
- [ ] または適切なブランチへのマージ/プッシュ
- [ ] ワークフロー実行状況の監視
- [ ] 各ステップの完了確認
- [ ] エラー発生時の対応準備

---

## デプロイ後確認

### 即座の確認（5分以内）
- [ ] アプリケーションが起動
- [ ] ホームページが表示
- [ ] ログイン機能が動作
- [ ] 主要API動作確認
- [ ] エラーログ確認

### 基本動作確認（30分以内）
- [ ] 主要機能のスモークテスト
- [ ] データベース接続確認
- [ ] サードパーティ連携確認
- [ ] 通知機能確認
- [ ] ファイルアップロード確認

### パフォーマンス確認
- [ ] ページロード時間測定
- [ ] APIレスポンスタイム確認
- [ ] エラー率確認
- [ ] CPU/メモリ使用率確認
- [ ] データベースクエリ時間確認

### モニタリング
- [ ] エラートラッキング（Sentry等）正常動作
- [ ] ログ収集動作確認
- [ ] メトリクス収集確認
- [ ] アラート設定確認
- [ ] ダッシュボード確認

---

## ロールバック手順

### 準備
- [ ] ロールバック用のタグ/コミット特定
- [ ] 前バージョンの動作確認済み
- [ ] チームへの通知準備
- [ ] ダウンタイム見積もり

### Web アプリケーション
```bash
# Vercel
vercel rollback

# AWS Amplify
aws amplify start-deployment --app-id <APP_ID> --branch-name main --job-id <PREVIOUS_JOB_ID>

# GitHub Actions（手動ロールバック）
git revert <COMMIT_HASH>
git push origin main
```

### iOS/Android
- [ ] App Store Connect/Google Playで前バージョンを有効化
- [ ] または Phased Release を一時停止
- [ ] ユーザーへのアナウンス

### データベース
```bash
# マイグレーションロールバック
npm run migrate:rollback

# または
npx prisma migrate rollback
```

---

## リリース後タスク

### ドキュメント更新
- [ ] CHANGELOG.md更新
- [ ] リリースノート作成
- [ ] APIドキュメント更新（変更がある場合）
- [ ] ユーザーガイド更新

### チーム通知
- [ ] Slackでリリース通知
- [ ] リリースメール送信（ステークホルダー）
- [ ] サポートチームへの情報共有
- [ ] マーケティングチームへの連絡

### モニタリング設定
- [ ] 24時間のエラー監視
- [ ] パフォーマンス異常の監視
- [ ] ユーザーフィードバックの収集
- [ ] クラッシュレート監視（モバイル）

### ポストモーテム（問題発生時）
- [ ] インシデントレポート作成
- [ ] 根本原因分析
- [ ] 再発防止策の策定
- [ ] チームでの知見共有

---

## 定期メンテナンス

### 週次
- [ ] デプロイ頻度の確認
- [ ] エラー率のトレンド分析
- [ ] パフォーマンスメトリクス確認
- [ ] ユーザーフィードバック確認

### 月次
- [ ] 依存関係のアップデート
- [ ] セキュリティパッチ適用
- [ ] ログの定期削除
- [ ] コスト最適化レビュー

### 四半期
- [ ] インフラ構成の見直し
- [ ] デプロイプロセスの改善
- [ ] ディザスタリカバリ訓練
- [ ] セキュリティ監査

---

## 緊急時対応

### インシデント発生時
1. **検知** (1-5分)
   - [ ] アラート受信
   - [ ] 影響範囲の特定
   - [ ] チームへの緊急連絡

2. **初動対応** (5-15分)
   - [ ] ステータスページ更新
   - [ ] ユーザーへのアナウンス
   - [ ] ロールバック検討・実施
   - [ ] 暫定対応実施

3. **恒久対応** (1-24時間)
   - [ ] 根本原因の特定
   - [ ] 修正版のデプロイ
   - [ ] 動作確認
   - [ ] モニタリング強化

4. **事後対応** (24時間-1週間)
   - [ ] ポストモーテム作成
   - [ ] 再発防止策実施
   - [ ] チームでの知見共有
   - [ ] プロセス改善

---

## チェックリストテンプレート

### 通常デプロイ（小規模変更）
```markdown
## デプロイ: [機能名] - [日付]

### デプロイ前
- [ ] テスト全パス
- [ ] コードレビュー完了
- [ ] ビルド成功

### デプロイ
- [ ] デプロイ実行
- [ ] 動作確認

### デプロイ後
- [ ] エラーログ確認
- [ ] Slack通知
```

### 大規模デプロイ（メジャーリリース）
```markdown
## メジャーリリース: v2.0.0 - [日付]

### デプロイ前（1週間前）
- [ ] リリースノート準備
- [ ] ステークホルダーへの事前通知
- [ ] ロールバック計画作成
- [ ] 段階的リリース計画

### デプロイ前（1日前）
- [ ] 全テスト実行
- [ ] パフォーマンステスト
- [ ] セキュリティスキャン
- [ ] データベースバックアップ

### デプロイ当日
- [ ] メンテナンス通知
- [ ] デプロイ実行
- [ ] Canaryリリース（10%）
- [ ] 監視（1時間）
- [ ] 段階的拡大（50%, 100%）

### デプロイ後（24時間）
- [ ] エラー率監視
- [ ] パフォーマンス監視
- [ ] ユーザーフィードバック収集
- [ ] リリース完了通知
```

---

## 環境別チェックリスト

### Development
- [ ] PRプレビュー動作確認
- [ ] 開発用データベース接続
- [ ] デバッグモード有効

### Staging
- [ ] 本番データのコピーで動作確認
- [ ] 本番環境と同じ構成
- [ ] E2Eテスト実施

### Production
- [ ] 全チェック項目完了
- [ ] 承認者のレビュー完了
- [ ] ロールバック手順確認済み
- [ ] 監視体制確立

---

**使い方:**
1. デプロイ前にこのチェックリストをコピー
2. Issue or Pull Requestに貼り付け
3. 各項目をチェックしながら進める
4. 問題があれば記録し、デプロイを延期

**最終更新**: 2026年1月
