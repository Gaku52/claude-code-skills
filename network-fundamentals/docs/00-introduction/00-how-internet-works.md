# インターネットの仕組み

> インターネットは「ネットワークのネットワーク」。データがあなたのPCからサーバーまでどう届くか、パケット通信、ルーティング、ISPの役割を理解する。

## この章で学ぶこと

- [ ] インターネットの物理的な構造を理解する
- [ ] パケット通信の仕組みを把握する
- [ ] データが目的地に届くまでの流れを学ぶ

---

## 1. インターネットの物理構造

```
インターネット = ケーブルで接続されたコンピュータの集合体

物理的な接続:
  あなたのPC
    ↓ Wi-Fi / Ethernet
  ルーター（家庭）
    ↓ 光ファイバー
  ISP（プロバイダ）
    ↓ バックボーン
  IX（Internet Exchange Point）
    ↓ 海底ケーブル / 大陸間回線
  目的地のデータセンター
    ↓ 内部ネットワーク
  サーバー

海底ケーブル:
  → 世界中に約550本の海底ケーブル
  → 総延長 130万km以上
  → 国際通信の 99% を担う
  → 直径約2cm の中に光ファイバー
  → 1本で数十Tbps の帯域

遅延の目安:
  東京 → 大阪:   ~5ms
  東京 → シンガポール: ~70ms
  東京 → US西海岸: ~100ms
  東京 → EU:     ~250ms
  → 光速の限界（30万km/s）により物理的に短縮不能
```

---

## 2. パケット通信

```
パケット交換（Packet Switching）:
  → データを小さな「パケット」に分割して送信
  → 各パケットが独立にルーティング
  → 到着先で再組み立て

  送信データ: "Hello, World!"

  パケット1: [ヘッダー][Hello, ]
  パケット2: [ヘッダー][World!]

  パケットヘッダーの内容:
  ┌─────────────────────────────────────┐
  │ 送信元IP:   192.168.1.100          │
  │ 宛先IP:     203.0.113.50           │
  │ プロトコル: TCP                     │
  │ 送信元ポート: 54321                 │
  │ 宛先ポート:   443                   │
  │ シーケンス番号: 1                   │
  │ チェックサム: 0xABCD                │
  └─────────────────────────────────────┘

  利点（回線交換と比較）:
  ✓ 回線の共有（多数の通信が同時に可能）
  ✓ 障害耐性（一部のルートが壊れても別経路で到達）
  ✓ 効率的な帯域利用
```

---

## 3. ルーティング

```
ルーティング = パケットの経路を決める仕組み

  PC [192.168.1.100]
    ↓ デフォルトゲートウェイ
  ルーター A [203.0.113.1]
    ↓ ルーティングテーブル参照
  ルーター B [198.51.100.1]
    ↓ BGP で最適経路を選択
  ルーター C [192.0.2.1]
    ↓
  目的地 [203.0.113.50]

  ルーティングテーブル（簡略化）:
  ┌──────────────────┬──────────────┬──────────┐
  │ 宛先ネットワーク │ 次のホップ   │ メトリック│
  ├──────────────────┼──────────────┼──────────┤
  │ 192.168.1.0/24   │ 直接接続     │ 0        │
  │ 10.0.0.0/8       │ 203.0.113.2  │ 1        │
  │ 0.0.0.0/0        │ 203.0.113.1  │ 10       │
  └──────────────────┴──────────────┴──────────┘

BGP（Border Gateway Protocol）:
  → ISP間のルーティングを決定
  → 「インターネットの郵便局」
  → AS（自律システム）間で経路情報を交換
```

---

## 4. Webページ表示の流れ

```
ブラウザで https://example.com を開くと:

  1. DNS解決
     example.com → 93.184.216.34
     （DNSサーバーに問い合わせ）

  2. TCP接続
     3-way ハンドシェイク
     SYN → SYN-ACK → ACK

  3. TLSハンドシェイク
     暗号化通信の確立
     証明書の検証

  4. HTTPリクエスト
     GET / HTTP/2
     Host: example.com

  5. HTTPレスポンス
     200 OK
     Content-Type: text/html
     <html>...</html>

  6. レンダリング
     HTML パース → DOM構築
     CSS パース → レンダリング
     JavaScript 実行

  所要時間の内訳（典型的）:
  DNS:        ~50ms
  TCP:        ~30ms（1.5 RTT）
  TLS:        ~50ms（1-2 RTT）
  HTTP:       ~100ms（サーバー処理 + 転送）
  レンダリング: ~200ms
  合計:       ~430ms
```

---

## 5. traceroute で経路を確認

```
$ traceroute example.com

 1  router.local (192.168.1.1)     1.234 ms
 2  isp-gw.example.net (203.0.113.1)  5.678 ms
 3  core-router.isp.net (198.51.100.1) 10.123 ms
 4  ix-tokyo.example (192.0.2.1)   15.456 ms
 5  cdn-edge.example.com (93.184.216.34) 20.789 ms

各行 = 1つのルーター（ホップ）
ms = そのルーターまでの往復時間（RTT）

→ パケットが通過する経路が可視化される
→ どこで遅延が発生しているか特定可能
```

---

## まとめ

| 概念 | ポイント |
|------|---------|
| 物理構造 | ケーブル + ルーター + ISP + IX |
| パケット通信 | データを分割して独立にルーティング |
| ルーティング | BGP で最適経路を自動決定 |
| Web表示 | DNS → TCP → TLS → HTTP → レンダリング |

---

## 次に読むべきガイド
→ [[01-osi-and-tcpip-model.md]] — OSI/TCP/IPモデル

---

## 参考文献
1. Kurose, J. "Computer Networking: A Top-Down Approach." 8th Ed, Pearson, 2021.
2. TeleGeography. "Submarine Cable Map." submarinecablemap.com.
