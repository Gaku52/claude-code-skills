# 教訓・ノウハウ

## Agent運用の教訓

### 最適なAgent設計
- 1 Agentあたり **10-15ファイル** が最適
- 50+ファイルはコンテキスト上限に達して途中停止するリスク大
- 同時Agent数は **8-10** が安定（15は稼働するが負荷が高い）

### 権限設定
- `Bash(mkdir *)` のような個別パターンはSubagentでマッチしない
- `Write(/path/**)` のようなパス指定もSubagentで失敗
- **`Write`, `Bash(*)` のように広い許可が必須**
- settings.json, settings.local.json, プロジェクト設定の **3箇所全て** に設定が必要

### バックグラウンドAgent
- `run_in_background: true` のAgentは自動で止まらない
- 「一時停止」はできない。`TaskStop` で明示停止のみ
- 停止後も一時ファイルが残る → 手動で `/private/tmp/claude-501/-Users-gaku/tasks/` を掃除

### リソース管理
- 15 Agent同時は消費が激しい
- レート制限に近づいたら非生成タスク（レビュー、カウント）に切り替え
- セッション終了前に必ず全Agentを停止すること

## 品質に関する教訓
- AI混在（Claude + ChatGPT + Gemini）は一貫性が損なわれるため非推奨
- 最終レビューで品質担保する方針は有効（執筆速度を優先できる）
- SKILL.mdの骨格を先に全て作ってからガイド執筆に入る流れが効率的

## セッション管理
- SESSION_ARCHIVE に全情報をストックしておけば再開コストほぼゼロ
- RESUME_PROMPT.md を用意しておけば新セッションでコピペ1回で再開可能
- MEMORY.md は自動読み込みされるが200行制限あり → 詳細は別ファイルに
